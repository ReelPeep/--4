#Домашнее задание 4

Тема: использование основных статистических тестов и поправок на множественные сравнения.

Цель: разберем использование основных параметрических и непараметрических статистических тестов, научимся вводить поправки на множественные сравнения и поймем, чем они отличаются.

## Задание 1 (2 балла)

Рассмотрите следующую статистическую гипотезу.

Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

Затем:

    Сформулируйте нулевую и альтернативную гипотезы.
    Определите уровень значимости.
    Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
    Определите наблюдаемое значение статистики, а также критическое значение статистики.
    Оцените и прокомментируйте статистическую значимость.


```{r}
library(ggplot2)
library(tidyverse)
```
```{r}
set.seed(42)

sample_size <- 30

mean_pressure_before <- 150  
mean_pressure_after <- 130  

sd_pressure <- 14
pressure_before <- rnorm(sample_size, mean_pressure_before, sd_pressure)

sd_pressure_after <- 8
pressure_after <- rnorm(sample_size, mean_pressure_after, sd_pressure_after)

df <- data.frame(pressure_before, pressure_after)
head(df)
```
- Сформулируйте нулевую и альтернативную гипотезы.
    
H0 - артериальное давление до и после приема препарата статистически значимо не отличаются

H1 - есть статистически значимая разница между артериальным давлением до и после приема препарата
- Определите уровень значимости.
Уровень значимости 0.05:

Проверяем на нормальность распределения перед выбором стат теста
```{r}
# визуальная оценка распределения артериального давления до приема препарата
ggplot(df, aes(x = pressure_before)) +
  geom_histogram(binwidth = 5,fill = "blue", color = "black") +
  labs(title = "Гистограмма распределения артериального давления до приема препарата", x = "Значения", y = "Частота") +
  theme_minimal()
```
```{r}
# визуальная оценка распределения артериального давления после приема препарата

ggplot(df, aes(x = pressure_after)) +
  geom_histogram(binwidth = 3, fill = "green", color = "black") +
  labs(title = "Гистограмма распределения артериального давления после приема препарата", x = "Значения", y = "Частота") +
  theme_minimal()
```
Визуально распределение отличается от нормального


Проверим нормальность на тесте Шапиро-Уилка
```{r}
alpha <- 0.05
shapiro.test(df$pressure_before)
shapiro.test(df$pressure_after)
```
Для обоих значения p-value выше 0.05, значит можно считать, что данные распределены нормально


- Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
Для сравнения двух зависимых выборок с нормально распределенными данными используем т-тест
```{r}
t.test(df$pressure_before, df$pressure_after, paired = TRUE)
```
p-value ниже 0.05 значит отвергаем нулевую гипотезу и принимаем альтернативную. Так же можно оценить 95% интервал, в котором лежат разность средних двух выборок [14.1 - 29.8], кол-во степеней свободы 29, значение t-статистики 5.73


-Определите наблюдаемое значение статистики, а также критическое значение статистики.
    Оцените и прокомментируйте статистическую значимость.
    
```{r}
# Расчет критического значения для нормального распределения
alpha = 0.05
qt(1 - alpha/2, df = 29)
```
По результатам теста, значение статистики превышает критическое значение



## Задание 2 (2 балла)

Рассмотрите следующую статистическую гипотезу.

Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

Затем:

    Сформулируйте нулевую и альтернативную гипотезы.
    Определите уровень значимости.
    Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
    Определите наблюдаемое значение статистики, а также критическое значение статистики.
    Оцените и прокомментируйте статистическую значимость.



```{r}
set.seed(42) 
sample_size <- 100
smoking_status <- rep(c(1, 0), each = (sample_size / 2))
smoker <- rbinom((sample_size / 2), 1, 0.8)
nonsmoker <- rbinom((sample_size / 2), 1, 0.2)

lung_cancer <- c(smoker, nonsmoker)

df100 <- data.frame(smoking_status, lung_cancer)

head(df100)
```

```{r}
set.seed(42) 
sample_size <- 30
smoking_status <- rep(c(1, 0), each = (sample_size / 2))
smoker <- rbinom((sample_size / 2), 1, 0.8)
nonsmoker <- rbinom((sample_size / 2), 1, 0.2)

lung_cancer <- c(smoker, nonsmoker)

df30 <- data.frame(smoking_status, lung_cancer)

head(df30)
```
-   Сформулируйте нулевую и альтернативную гипотезы.

H0 - вероятность развития рака легких в обеих группах  одинакова 

H1 - в группе курящих риск развития рака легких статистически значимо выше, чем в группе некурящих.`

-   Определите уровень значимости.

alpha =  0.05:

-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.


```{r}
# Построение столбчатой диаграммы для первой выборки
barplot(table(df100$smoking_status, df100$lung_cancer), beside = TRUE,
        col = c("blue", "red"), legend = c("Нет рака легких", "Рак легких"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких среди курящих и некурящих людей (выборка 100)",
        ylab = "Количество наблюдений")
# Построение столбчатой диаграммы для второй выборки
barplot(table(df30$smoking_status, df30$lung_cancer), beside = TRUE,
        col = c("blue", "red"), legend = c("Нет рака легких", "Рак легких"),
        names.arg = c("Некурящие", "Курящие"), main = "Рак легких среди курящих и некурящих людей (выборка 30)",
        ylab = "Количество наблюдений")
```
- в обеих выборках событие распределено между выборками курящих и некурящих неравномерно по условию задачи.

- переменные обе категориальные

- выбираем тест Фишера

```{r}

table100 <- table(df100$smoking_status, df100$lung_cancer)
# Применяем точный тест Фишера
result100 <- fisher.test(table100, alternative = "greater")
result100
```
```{r}
table30 <- table(df30$smoking_status, df30$lung_cancer)
# Применяем точный тест Фишера
result30 <- fisher.test(table30, alternative = "greater")
result30
```
-   Определите наблюдаемое значение статистики, а также критическое значение статистики.

Для первой выборки из 100 получено p-value < .05, а во второй получили больше .05, чтобы не совершить ошибку нельзя и не принять и не отвергнуть нулевую гипотезу. 



## Задание 3 (3 балла)

Рассмотрите следующую статистическую гипотезу.

Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение.

Что нужно сделать:

    Сформулируйте нулевую и альтернативную гипотезы.
    Определите уровень значимости.
    Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.
    Определите наблюдаемое значение статистики, а также критическое значение статистики.
    Оцените и прокомментируйте статистическую значимость.

```{r}
set.seed(42)
sample_size <- 100

mean_new_treatment <- 6
sd_new_treatment <- 2
mean_diet_therapy <- 8
sd_diet_therapy <- 2
new_treatment_group <- round(rnorm(sample_size, mean_new_treatment, sd_new_treatment))
diet_therapy_group <- round(rnorm(sample_size, mean_diet_therapy, sd_diet_therapy))

treatment <- data.frame(New_method = new_treatment_group,
                            Dietotherapy = diet_therapy_group)

head(treatment)
```
-   Сформулируйте нулевую и альтернативную гипотезы.

H0 - нет статистически значимых различий между эффективностью лечения новым методом и диетотерапией.

H1 - Есть статистически значимые различия между эффективностью лечения новым методом и диетотерапией.

-   Определите уровень значимости.

alpha = 0.05:


-   Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор

```{r}
ggplot(treatment, aes(x = New_method)) + 
            geom_histogram(binwidth = 1,fill = "99FF99", color = "black") + 
            labs(title = "Гистограмма распределения уровня боли при использовании нового метода лечения", x = "Уровень боли", y = "Частота") + 
            theme_minimal() 
ggplot(treatment, aes(x = Dietotherapy)) + 
            geom_histogram(binwidth = 1,fill = "66FFFF", color = "black") + 
            labs(title = "Гистограмма распределения уровня боли при использовании диетотерапии", x = "Уровень боли", y = "Частота") + 
            theme_minimal() 
```
```{r}
shapiro.test(treatment$New_method) 
shapiro.test(treatment$Dietotherapy)
```
В обеих выборках p-value ниже alpha, Значит данные распределенны ненормально
Используем тест Манна-Уитни

```{r}
wilcox.test(treatment$New_method, treatment$Dietotherapy)
```
p-val значительно ниже alpha, значит отвергаем нулевую гипотезу и принимаем альтернативную



## Задание 4 (4 балла)

Рассмотрите следующую гипотезу.

Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.

Сгенерируйте датасет следующим образом:


Постройте на одном графике три «ящика с усами» для наглядности.

    Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 
    Прокомментируйте получившийся результат.
    С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
    Прокомментируйте полученные результаты.

```{r}
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)
```

```{r}
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Распределения значений размера опухоли у мышей", x = "Вид лечения", y = "Размер опухоли") +
  theme_minimal()
```
Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 

```{r}
shapiro.test(tumor$value[tumor$therapy == 0])
shapiro.test(tumor$value[tumor$therapy == 'A'])
shapiro.test(tumor$value[tumor$therapy == 'B'])
```
Распределение нормальное во всех выборках

Так как у нас в одной из групп распрделение ненормальное, то выбираем дисперсионный анализ Краскела-Уоллиса для непараметрических данных

```{r}
kruskal_test = kruskal.test(value ~ therapy, data = tumor)
kruskal_test
```
По результат дисперсионного анализа p-value выше 0.05 значит принимаем нулевую гипотезу. кол-во степеней свободы - 2, хи-квадрат 2.0465 


С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
```{r}
aov_model <- aov(value ~ therapy, data = tumor)
summary(aov_model)
tukey_results <- TukeyHSD(aov_model, confV.level = 0.95)
print(tukey_results)
```
Во всех выборках p adj выше 0.05, как и в тесте Краскела-Уоллиса, значит принимаем нулевую гипотезу










